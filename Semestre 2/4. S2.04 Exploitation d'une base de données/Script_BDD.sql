-- CREATE TABLE Etudiants (
--     idEtudiants INT PRIMARY KEY,
--     Nom VARCHAR (50),
--     Prenom VARCHAR (50),
--     Groupe VARCHAR (50),
--     Mail VARCHAR (50) 
-- );

-- CREATE TABLE Enseignants (
--   IdEnseignants INT PRIMARY KEY,
--   Nom VARCHAR(50),
--   Prenom VARCHAR(50),
--   Mail VARCHAR(50)
-- );

-- CREATE TABLE Controles (
--   idControles VARCHAR (50),
--   idEtudiants INT,
--   idMatieres VARCHAR (50),
--   idEnseignants INT,
--   Type VARCHAR (50),
--   Note FLOAT,
--   PRIMARY KEY (idEnseignants, idEtudiants, idControles, idMatieres),  
--   FOREIGN KEY (idEnseignants) REFERENCES Enseignants (IdEnseignants),
--   FOREIGN KEY (idEtudiants) REFERENCES Etudiants (idEtudiants)
-- );

-- CREATE TABLE Matieres (
--     idEnseignants INT,
--     idMatieres VARCHAR(50),
--     Matiere VARCHAR (50),
--     PRIMARY KEY (idEnseignants, idMatieres),
--     FOREIGN KEY (idEnseignants) REFERENCES Enseignants (idEnseignants)
-- );

-- INSERT INTO Enseignants(IdEnseignants, Nom, Prenom, Mail) VALUES
-- (12203353,'Galindo','Adrian','Galindo.adrig@gmail.com'),
-- (12213513,'Rattinassababady','Bharani','Bharani.ratti@gmail.com');

-- INSERT INTO Etudiants(idEtudiants, Nom, Prenom, Groupe ,Mail) VALUES 
-- (12213377,'Saravanan','Bryan','Indra','Saravanan.Bryan@gmail.com'),
-- (12202185,'Soupramaniane','Vimal','Indra','Soupramaniane.Vimal@gmail.com'),
-- (12416752,'Fuentes','Santiago','Zeus','Fuentes.santiago@gmail.com');

-- INSERT INTO Matieres (idEnseignants, idMatieres, Matiere) VALUES
-- (12203353,'R100','Mathématiques appliquées à l informatique'),
-- (12203353,'R101','Bases de données'),
-- (12203353,'R102','Architecture des ordinateurs'),
-- (12203353,'R103','Réseaux informatiques'),
-- (12213513,'R104','Systèmes d exploitation'),
-- (12213513,'R105','Programmation orientée objet'),
-- (12213513,'R106','Développement web'),
-- (12213513,'R107','Anglais technique'),
-- (12213513,'R108','Bases de la communication'),
-- (12203353,'R109','Recuil de besoins'),
-- (12213513,'R110','Economie durable et numérique');

-- INSERT INTO Controles(idControles, idEtudiants, idMatieres, idEnseignants, Type, Note) VALUES 
-- ('C-0',12213377,'R100',12203353,'Examen',16),
-- ('C-1',12213377,'R101',12213513,'Examen',14),
-- ('C-2',12213377,'R102',12203353,'Controle',15),
-- ('C-3',12213377,'R103',12213513,'Controle',12),
-- ('C-4',12213377,'R104',12203353,'SAE',16),
-- ('C-5',12213377,'R105',12213513,'SAE',16),
-- ('C-0',12202185,'R100',12203353,'Examen',11),
-- ('C-1',12202185,'R101',12213513,'Examen',18),
-- ('C-2',12202185,'R102',12203353,'Controle',13),
-- ('C-3',12202185,'R103',12213513,'Controle',11),
-- ('C-4',12202185,'R104',12203353,'SAE',19),
-- ('C-5',12202185,'R105',12213513,'SAE',10),
-- ('C-0',12416752,'R100',12203353,'Examen',14),
-- ('C-1',12416752,'R101',12213513,'Examen',17),
-- ('C-2',12416752,'R102',12203353,'Controle',13),
-- ('C-3',12416752,'R103',12213513,'Controle',18),
-- ('C-4',12416752,'R104',12203353,'SAE',12),
-- ('C-5',12416752,'R105',12213513,'SAE',9);

-- CREATE OR REPLACE FUNCTION notes_etudiant(
--     in id int, out Nom VARCHAR, out Prenom VARCHAR, out Groupe VARCHAR,
--     out idControles VARCHAR, out idMatieres VARCHAR, out Type VARCHAR, out Note float
-- ) RETURNS SETOF record
-- AS
-- $$
-- SELECT Nom, Prenom, Groupe, idControles, idMatieres, type, Note
--         FROM Controles JOIN Etudiants ON Etudiants.idEtudiants=controles.idEtudiants
--              WHERE Controles.idEtudiants=$1;
-- $$ LANGUAGE SQL;

-- CREATE OR REPLACE FUNCTION note_groupe(
--     in groupe VARCHAR,out Nom VARCHAR, out Prenom VARCHAR,
--     out Groupe VARCHAR, out idControles VARCHAR, out idMatieres VARCHAR,
--      out Type VARCHAR, out Note float)
-- RETURNS SETOF record
-- AS
-- $$
--     SELECT Nom, Prenom, Groupe, idControles, idMatieres, type, Note
--         FROM Controles JOIN Etudiants ON Controles.idEtudiants=Etudiants.idEtudiants
--             WHERE Etudiants.groupe=$1;
-- $$ LANGUAGE SQL;

-- CREATE OR REPLACE FUNCTION moy_controle(
--     in controle VARCHAR, out Matiere VARCHAR, out Moyenne float)
-- RETURNS SETOF record
-- AS
-- $$
--     SELECT idControles, avg(note)
--         FROM controles
--             WHERE idControles=$1 GROUP BY idControles;
-- $$ LANGUAGE SQL;

-- CREATE OR REPLACE FUNCTION moy_controle_groupe(
--     in controle VARCHAR, out Groupe VARCHAR, out Moyenne VARCHAR)
-- RETURNS SETOF record
-- AS
-- $$
--     SELECT groupe, avg(note) FROM Controles 
--         JOIN Etudiants ON Controles.idEtudiants=Etudiants.idEtudiants
--             WHERE idControles=$1 GROUP BY groupe;
-- $$ LANGUAGE SQL;

-- CREATE USER "12203353" WITH PASSWORD '0000';
-- CREATE USER "12213377" WITH PASSWORD '0000';
-- CREATE USER SuperUtilisateur WITH PASSWORD '0000'; 

-- CREATE GROUP Role_Enseignants WITH USER "12203353";
-- CREATE GROUP Role_Etudiants WITH USER "12213377";

-- GRANT SELECT ON Enseignants TO Role_Enseignants;
-- GRANT SELECT ON Etudiants TO Role_Enseignants;
-- GRANT SELECT ON matieres TO Role_Enseignants;
-- GRANT SELECT, UPDATE, INSERT ON Controles TO Role_Enseignants;

-- GRANT SELECT ON matieres TO Role_Etudiants;
-- GRANT SELECT ON Controles TO Role_Etudiants;

-- GRANT ALL PRIVILEGES ON Enseignants TO SuperUtilisateur;
-- GRANT ALL PRIVILEGES ON Etudiants TO SuperUtilisateur;
-- GRANT ALL PRIVILEGES ON Matieres TO SuperUtilisateur;
-- GRANT ALL PRIVILEGES ON Controles TO SuperUtilisateur;